{% extends "aa_bulletin_board/base.html" %}

{% load i18n %}

{% block aabulletinboard_body %}
    {% include "aa_bulletin_board/partials/common/bulletin-board-management.html" %}

    {% if bulletins %}
        <div class="row cards-equal-height">
            {% for bulletin in bulletins %}
                <div class="card-bulletin-excerpt col-md-4 mb-4">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title mb-0 clearfix">
                                <span>{{ bulletin.title }}</span>
                                {% if bulletin.groups.all %}
                                    <i
                                        class="far fa-eye-slash aa-bulletin-board-marker-group-restrictions float-end"
                                        title="{% blocktranslate count group_count=bulletin.groups.all|length %}This bulletin is restricted to the following group:{% plural %}This bulletin is restricted to the following groups:{% endblocktranslate %}<br>{{ bulletin.groups.all|join:', ' }}"
                                        data-bs-toggle="tooltip"
                                        data-bs-html="true"
                                    ></i>
                                {% endif %}
                            </div>
                        </div>

                        <div class="card-body">
                            {{ bulletin.content|safe }}
                        </div>

                        <div class="card-footer-read-more-button card-footer-no-background">
                            <p class="my-2">
                                <a class="btn bg-success btn-sm btn-read-more" href="{% url 'aa_bulletin_board:view_bulletin' bulletin.slug %}">{% translate "Read more" %}</a>

                                {% if perms.aa_bulletin_board.manage_bulletins %}
                                    <a class="btn bg-warning btn-sm btn-read-more" href="{% url 'aa_bulletin_board:edit_bulletin' bulletin.slug %}">{% translate "Edit" %}</a>
                                    <a class="btn bg-danger btn-sm btn-read-more" href="{% url 'aa_bulletin_board:remove_bulletin' bulletin.slug %}">{% translate "Delete" %}</a>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}

{% block extra_javascript %}
    <script>
        $(document).ready(() => {
            'use strict';

            const resizeBulletinCard = () => {
                let highestBox = 0;

                $('.cards-equal-height').each((indexEqualHeight, elementEqualHeight) => {
                    $('.card-bulletin-excerpt', elementEqualHeight).each((indexExcerpt, elementExcerpt) => {
                        let currentBulletinHeight = $(elementExcerpt).height();

                        if (currentBulletinHeight > highestBox) {
                            highestBox = currentBulletinHeight;
                        }
                    });

                    $('.card-bulletin-excerpt', elementEqualHeight).height(highestBox);
                });
            }

            resizeBulletinCard();

            $(window).on('resize', () => {
                $('.card-bulletin-excerpt').css({"height": ""});

                resizeBulletinCard();
            });

            $(".aa-bulletin-board-marker-group-restrictions").tooltip({
                placement: 'bottom',
                html: true
            });
        });
    </script>
{% endblock %}

{% block extra_css %}
    {% include "aa_bulletin_board/bundles/aa-bulletin-board-css.html" %}
{% endblock %}
